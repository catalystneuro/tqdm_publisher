<!DOCTYPE html>
 
<html lang="en">
 
<head>
 
    <meta charset="UTF-8">
 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    <title>Concurrent Client Demo</title>

    <style>

        html, body {
            font-family: sans-serif;
        }

        h1 {
            margin: 0;
            padding: 0;
            font-size: 1.5rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
        }

        #bars {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .progress {
            width: 100%;
            height: 20px;
            background-color: #ddd;
        }
 
 
 
        .progress div {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
        }

    </style>
 
</head>
 
<body>
    <header>
        <div>
            <h1>tqdm_progress</h1>
            <i><small>Create multiple progress bars to test concurrent subscriptions</small></i>
        </div>
        <button>Create Progress Bar</button>
    </header>

    <div id="bars">

    </div>
 
</body>
 
<script>

    const bars = document.querySelector('#bars');

    class ProgressClient {
        constructor() {
            this.socket = new WebSocket('ws://localhost:8000');

            this.element = document.createElement('div');
            this.element.classList.add('progress');
            const progress = document.createElement('div');
            this.element.appendChild(progress);
            bars.appendChild(this.element);
            
            this.socket.addEventListener('message', function (event) {
                const data = JSON.parse(event.data);
                progress.style.width = 100 * (data.n / data.total) + '%';
            });
 
        }

        close() {
            this.socket.close();
            this.element.remove()
        }

    }

const button = document.querySelector('button');
button.addEventListener('click', () => {
    const client = new ProgressClient();
})
 
</script>
 
</html>